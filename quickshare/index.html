<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUICKSHARE</title>
    <style>
        :root { --neon: #00ff88; --bg: #020617; --card: #0f172a; --red: #ff4444; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; min-height: 100vh; display: flex; flex-direction: column; }
        .logged-in-bg { background: radial-gradient(circle at center, #0a192f, #020617) !important; }
        
        #snow-canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 1; display: none; }
        .garland { position: fixed; top: 0; width: 100%; height: 6px; background: linear-gradient(90deg, #f00 25%, #0f0 25%, #0f0 50%, #00f 50%, #00f 75%, #ff0 75%); background-size: 40px 100%; animation: flash 1s infinite linear; display: none; z-index: 1001; }
        @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }

        /* GLOBAL SEARCH BAR */
        .top-search-bar { background: rgba(0,0,0,0.9); padding: 12px 5%; display: flex; justify-content: center; gap: 15px; border-bottom: 1px solid #334155; position: sticky; top: 0; z-index: 1100; backdrop-filter: blur(15px); }
        .search-input { background: #1e293b; border: 1px solid var(--neon); color: white; padding: 10px 20px; border-radius: 25px; width: 400px; outline: none; font-size: 14px; }
        .search-mode-btn { background: #334155; color: white; border: 1px solid var(--neon); border-radius: 25px; padding: 8px 20px; cursor: pointer; font-size: 12px; font-weight: bold; transition: 0.3s; min-width: 130px; }
        .search-mode-btn.active { background: var(--neon); color: #020617; }

        header { background: rgba(0,0,0,0.8); padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #1e293b; }
        .main-content { flex: 1; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto 30px; padding: 25px; background: var(--card); border-radius: 15px; border: 1px solid #334155; position: relative; z-index: 10; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        textarea { width: 100%; height: 350px; background: #000; color: var(--neon); border: 1px solid #1e293b; padding: 15px; box-sizing: border-box; font-family: monospace; border-radius: 8px; outline: none; margin-bottom: 15px; }
        .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        input, select { background: #1e293b; border: 1px solid #334155; color: white; padding: 12px; border-radius: 6px; width: 100%; box-sizing: border-box; }
        
        .btn { padding: 14px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.2s; font-size: 12px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-main { background: var(--neon); color: #020617; }
        .btn-sec { background: #334155; color: white; }
        
        /* SEARCH RESULTS */
        .results-section { margin-top: 20px; }
        .share-card { background: #1e293b; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid var(--neon); transition: 0.3s; }
        .share-card:hover { transform: translateX(5px); background: #232f42; }
        .tag-pill { background: rgba(0,255,136,0.1); color: var(--neon); padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-right: 5px; border: 1px solid var(--neon); }
        .no-results { text-align: center; padding: 40px; color: var(--red); font-weight: bold; }

        footer { text-align: center; padding: 30px; color: #475569; font-size: 12px; }
    </style>
</head>
<body id="body-tag">

<div class="top-search-bar">
    <input type="text" id="globalSearch" class="search-input" placeholder="Search across all shares..." oninput="performGlobalSearch()">
    <button id="modeSwitcher" class="search-mode-btn" onclick="toggleSearchMode()">TITLE NAME</button>
</div>

<div class="garland" id="garland"></div>
<canvas id="snow-canvas"></canvas>

<header>
    <div style="color:var(--neon); font-weight:bold; font-size:24px; cursor:pointer" onclick="location.href='./'">‚ùÑÔ∏è QUICKSHARE</div>
    <div id="auth-box"></div>
</header>

<div class="main-content">
    <div class="container" id="editor-ui">
        <input type="text" id="share-title" placeholder="Enter share title *" style="margin-bottom:15px">
        <textarea id="editor" placeholder="Type your content..."></textarea>
        
        <div id="auth-tools" style="display:none">
            <div class="settings-grid">
                <input type="text" id="share-tags" placeholder="Tags (comma separated)">
                <input type="password" id="share-pass" placeholder="Protection Password">
            </div>
            <div class="settings-grid">
                <select id="share-life"><option value="0">Permanent</option><option value="24">24 Hours</option></select>
                <label style="display:flex; align-items:center; gap:8px; font-size:12px; cursor:pointer">
                    <input type="checkbox" id="use-captcha"> Enable ShareCaptcha
                </label>
            </div>
        </div>

        <div class="settings-grid">
            <button class="btn btn-sec" onclick="document.getElementById('f-up').click()">üìÇ Upload File</button>
            <input type="file" id="f-up" style="display:none" onchange="importFile(this)">
            <button class="btn btn-main" onclick="publishShare()">üöÄ Publish</button>
        </div>
    </div>

    <div class="container results-section" id="search-container" style="display:none">
        <h3 id="results-count" style="color:var(--neon)">Search Results</h3>
        <div id="results-list"></div>
    </div>
</div>

<footer>Made by GitHub Pages!</footer>

<script>
    const user = localStorage.getItem('loggedUser');
    const isAuth = !!user;
    let currentMode = 'title'; // or 'tag'

    if(isAuth) {
        document.getElementById('body-tag').classList.add('logged-in-bg');
        document.getElementById('garland').style.display = 'block';
        document.getElementById('auth-tools').style.display = 'block';
        initSnow();
    }

    document.getElementById('auth-box').innerHTML = isAuth ? `${user} | <button class="btn-sec" style="padding:4px 8px; font-size:10px" onclick="localStorage.removeItem('loggedUser');location.reload()">EXIT</button>` : `<button class="btn-sec" onclick="location.href='./login'">LOGIN</button>`;

    function toggleSearchMode() {
        currentMode = (currentMode === 'title') ? 'tag' : 'title';
        document.getElementById('modeSwitcher').innerText = currentMode === 'title' ? 'TITLE NAME' : 'TITLE TAG';
        document.getElementById('globalSearch').placeholder = currentMode === 'title' ? 'Enter one name...' : 'Enter tags (e.g. news, python)...';
        performGlobalSearch();
    }

    function importFile(input) {
        const file = input.files[0];
        const r = new FileReader();
        r.onload = (e) => { document.getElementById('editor').value = e.target.result; document.getElementById('share-title').value = file.name; };
        r.readAsText(file);
    }

    function publishShare() {
        const title = document.getElementById('share-title').value;
        const tags = document.getElementById('share-tags').value.split(',').map(t => t.trim().toLowerCase()).filter(t => t);
        const data = { t: title, c: document.getElementById('editor').value, tags: tags, u: user || 'Guest', ts: Date.now() };
        
        const link = window.location.origin + window.location.pathname + "?s=" + btoa(unescape(encodeURIComponent(JSON.stringify(data))));
        
        // Simulating global storage for search demo
        let allShares = JSON.parse(localStorage.getItem('global_shares') || '[]');
        allShares.push({...data, url: link});
        localStorage.setItem('global_shares', JSON.stringify(allShares));
        
        prompt("Share Published! Link:", link);
    }

    function performGlobalSearch() {
        const query = document.getElementById('globalSearch').value.trim().toLowerCase();
        const resultsBox = document.getElementById('search-container');
        const list = document.getElementById('results-list');
        
        if(!query) { resultsBox.style.display = 'none'; return; }
        resultsBox.style.display = 'block';
        list.innerHTML = '';

        const allData = JSON.parse(localStorage.getItem('global_shares') || '[]');
        let filtered = [];

        if(currentMode === 'title') {
            filtered = allData.filter(item => item.t.toLowerCase().includes(query));
        } else {
            const searchTags = query.split(/[\s,]+/).filter(t => t);
            filtered = allData.filter(item => {
                return searchTags.some(st => item.tags && item.tags.includes(st));
            });
        }

        if(filtered.length === 0) {
            list.innerHTML = '<div class="no-results">No results found for your request.</div>';
        } else {
            filtered.forEach(item => {
                const card = document.createElement('div');
                card.className = 'share-card';
                card.innerHTML = `
                    <div>
                        <div style="font-weight:bold">${item.t}</div>
                        <div style="margin-top:5px">${(item.tags || []).map(t => '<span class="tag-pill">#'+t+'</span>').join('')}</div>
                        <small style="color:#475569">By ${item.u}</small>
                    </div>
                    <button class="btn btn-main" style="padding:8px 15px" onclick="location.href='${item.url}'">OPEN</button>
                `;
                list.appendChild(card);
            });
        }
    }

    function initSnow() {
        const canvas = document.getElementById('snow-canvas');
        const ctx = canvas.getContext('2d');
        canvas.style.display = 'block';
        let W = window.innerWidth, H = window.innerHeight;
        canvas.width = W; canvas.height = H;
        let flakes = Array.from({length: 60}, () => ({x: Math.random()*W, y: Math.random()*H, r: Math.random()*3+1, d: Math.random()*1}));
        function draw() {
            ctx.clearRect(0, 0, W, H); ctx.fillStyle = "white"; ctx.beginPath();
            flakes.forEach(f => { ctx.moveTo(f.x, f.y); ctx.arc(f.x, f.y, f.r, 0, Math.PI*2, true); });
            ctx.fill();
            flakes.forEach(f => { f.y += f.d + 1; if(f.y > H) f.y = -10; });
            requestAnimationFrame(draw);
        }
        draw();
    }
</script>
</body>
</html>
