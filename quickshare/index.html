<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUICKSHARE</title>
    <style>
        :root { --neon: #00ff88; --bg: #020617; --card: #0f172a; --red: #ff4444; --gold: #ffd700; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; min-height: 100vh; display: flex; flex-direction: column; }
        .logged-in-bg { background: radial-gradient(circle at center, #0a192f, #020617) !important; }
        
        /* SEARCH AREA */
        .search-wrapper { background: rgba(0,0,0,0.9); padding: 15px 5%; border-bottom: 1px solid #334155; position: sticky; top: 0; z-index: 1100; backdrop-filter: blur(15px); text-align: center; }
        .search-container-box { display: flex; justify-content: center; gap: 10px; align-items: center; }
        .search-input { background: #1e293b; border: 1px solid var(--neon); color: white; padding: 10px 20px; border-radius: 25px; width: 400px; outline: none; }
        #search-error { color: var(--red); font-size: 14px; margin-top: 8px; font-weight: bold; height: 20px; opacity: 0; transition: 0.3s; }

        header { background: rgba(0,0,0,0.8); padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #1e293b; }
        .main-content { flex: 1; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto 30px; padding: 25px; background: var(--card); border-radius: 15px; border: 1px solid #334155; position: relative; z-index: 10; }
        
        textarea { width: 100%; height: 350px; background: #000; color: var(--neon); border: 1px solid #1e293b; padding: 15px; box-sizing: border-box; font-family: monospace; border-radius: 8px; outline: none; }
        .btn { padding: 12px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 12px; }
        .btn-main { background: var(--neon); color: #020617; }
        .btn-sec { background: #334155; color: white; }

        .share-card { background: #1e293b; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid var(--neon); }
        .admin-badge { color: var(--gold); margin-left: 5px; }

        footer { text-align: center; padding: 30px; color: #475569; font-size: 12px; }
    </style>
</head>
<body id="body-tag">

<div class="search-wrapper">
    <div class="search-container-box">
        <input type="text" id="globalSearch" class="search-input" placeholder="Search shares..." oninput="handleSearch(this.value)">
        <button id="modeSwitcher" class="btn btn-sec" style="border-radius: 25px;" onclick="toggleSearchMode()">TITLE NAME</button>
    </div>
    <div id="search-error">Nothing found!</div>
</div>

<header>
    <div style="color:var(--neon); font-weight:bold; font-size:24px; cursor:pointer" onclick="location.reload()">‚ùÑÔ∏è QUICKSHARE</div>
    <div id="auth-box"></div>
</header>

<div class="main-content">
    <div class="container" id="editor-page">
        <input type="text" id="share-title" placeholder="Title *" style="width:100%; padding:12px; background:#1e293b; border:1px solid #334155; color:white; border-radius:6px; margin-bottom:15px;">
        <textarea id="editor" placeholder="Write something..."></textarea>
        <div style="display:flex; gap:10px; margin-top:15px;">
            <button class="btn btn-main" style="flex:1" onclick="publishShare()">üöÄ Publish</button>
        </div>
    </div>

    <div class="container" id="results-page" style="display:none">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 style="color:var(--neon); margin:0;">Search Results</h2>
            <button class="btn btn-sec" onclick="location.reload()">Close Search</button>
        </div>
        <div id="results-list"></div>
    </div>

    <div class="container" id="profile-page" style="display:none">
        <h1 id="p-name"></h1>
        <div id="p-shares"></div>
    </div>
</div>

<footer>Made by GitHub Pages!</footer>

<script>
    const user = localStorage.getItem('loggedUser');
    const isAuth = !!user;
    let searchMode = 'title';
    let errorTimeout;

    function formatUser(name) {
        return name === 'admin' ? name + '<span class="admin-badge">üéÑ</span>' : name;
    }

    // Auth rendering
    document.getElementById('auth-box').innerHTML = isAuth ? 
        `<span style="font-weight:bold; cursor:pointer" onclick="openProfile()">${formatUser(user)}</span>` : 
        `<button class="btn btn-sec" onclick="location.href='./login'">LOGIN</button>`;

    function toggleSearchMode() {
        searchMode = (searchMode === 'title') ? 'tag' : 'title';
        document.getElementById('modeSwitcher').innerText = searchMode === 'title' ? 'TITLE NAME' : 'TITLE TAG';
        handleSearch(document.getElementById('globalSearch').value);
    }

    function handleSearch(query) {
        query = query.trim().toLowerCase();
        const resultsPage = document.getElementById('results-page');
        const editorPage = document.getElementById('editor-page');
        const profilePage = document.getElementById('profile-page');
        const errorEl = document.getElementById('search-error');
        const list = document.getElementById('results-list');

        if (!query) {
            resultsPage.style.display = 'none';
            editorPage.style.display = 'block';
            return;
        }

        const allData = JSON.parse(localStorage.getItem('global_shares') || '[]');
        let filtered = [];

        if (searchMode === 'title') {
            filtered = allData.filter(item => item.t.toLowerCase().includes(query));
        } else {
            const searchTags = query.split(/[\s,]+/).filter(t => t);
            filtered = allData.filter(item => searchTags.some(st => item.tags && item.tags.includes(st)));
        }

        if (filtered.length > 0) {
            editorPage.style.display = 'none';
            profilePage.style.display = 'none';
            resultsPage.style.display = 'block';
            errorEl.style.opacity = '0';
            
            list.innerHTML = '';
            filtered.forEach(item => {
                list.innerHTML += `
                    <div class="share-card">
                        <div>
                            <div style="font-weight:bold">${item.t}</div>
                            <small>By ${formatUser(item.u)}</small>
                        </div>
                        <button class="btn btn-main" onclick="location.href='${item.url}'">OPEN</button>
                    </div>`;
            });
        } else {
            // Show error if nothing found
            errorEl.style.opacity = '1';
            clearTimeout(errorTimeout);
            errorTimeout = setTimeout(() => { errorEl.style.opacity = '0'; }, 3000);
            
            resultsPage.style.display = 'none';
            editorPage.style.display = 'block';
        }
    }

    function publishShare() {
        const title = document.getElementById('share-title').value;
        if(!title) return;
        const data = { t: title, u: user || 'Guest', tags: [], ts: Date.now() };
        const link = window.location.origin + window.location.pathname + "?s=" + btoa(unescape(encodeURIComponent(JSON.stringify(data))));
        let all = JSON.parse(localStorage.getItem('global_shares') || '[]');
        all.push({...data, url: link});
        localStorage.setItem('global_shares', JSON.stringify(all));
        alert("Published!");
        location.reload();
    }
</script>
</body>
</html>
