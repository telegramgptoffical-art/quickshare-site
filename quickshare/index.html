<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickShare PRO - Restricted Guest Mode</title>
    <style>
        :root { --neon: #00ff88; --bg: #020617; --card: #0f172a; --gray: #475569; }
        body { background: radial-gradient(circle, #0a192f, var(--bg)); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; min-height: 100vh; padding-bottom: 50px; }
        header { background: rgba(0,0,0,0.6); padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #1e293b; backdrop-filter: blur(10px); }
        .container { max-width: 900px; margin: 30px auto; padding: 25px; background: var(--card); border-radius: 15px; border: 1px solid #334155; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        textarea { width: 100%; height: 300px; background: #000; color: var(--neon); border: 1px solid #1e293b; padding: 15px; box-sizing: border-box; font-family: 'Consolas', monospace; border-radius: 8px; outline: none; }
        .grid-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        input { background: #1e293b; border: 1px solid #334155; color: white; padding: 12px; border-radius: 6px; outline: none; }
        input:disabled { opacity: 0.5; cursor: not-allowed; background: #0f172a; border-color: #1e293b; }
        .btn { padding: 12px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.2s; font-size: 11px; }
        .btn-main { background: var(--neon); color: #020617; }
        .btn-sec { background: #334155; color: white; }
        .btn:disabled { background: #1e293b; color: var(--gray); cursor: not-allowed; border: 1px solid #334155; }
        .lock-hint { font-size: 10px; color: #facc15; display: block; margin-top: -10px; margin-bottom: 10px; }
        .history-list { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        .share-card { background: #1e293b; padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--neon); }
        .tag-pill { background: rgba(0,255,136,0.1); color: var(--neon); padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-right: 5px; border: 1px solid var(--neon); }
        .share-view { display: none; }
    </style>
</head>
<body>

<header>
    <div style="color:var(--neon); font-weight:bold; font-size:20px; cursor:pointer" onclick="location.href='./'">‚ùÑÔ∏è QUICKSHARE PRO</div>
    <div id="auth-box"></div>
</header>

<div class="container" id="main-ui">
    <div class="grid-inputs">
        <input type="text" id="share-title" placeholder="Title *">
        <input type="text" id="share-tags" placeholder="Tags (comma separated)">
    </div>
    
    <textarea id="editor" placeholder="Write something..."></textarea>
    
    <div class="grid-inputs" style="margin-top:20px;">
        <div>
            <input type="password" id="share-pass" placeholder="Password (Users Only)" style="width:100%; box-sizing:border-box;">
            <span id="pass-hint" class="lock-hint" style="display:none">‚ö†Ô∏è Login to enable password</span>
        </div>
        <div>
            <button class="btn btn-sec" id="btn-upload" style="width:100%" onclick="document.getElementById('file-upload').click()">üìÇ Upload File</button>
            <span id="file-hint" class="lock-hint" style="display:none">‚ö†Ô∏è Login to upload files</span>
            <input type="file" id="file-upload" style="display:none" onchange="handleFileUpload(this)">
        </div>
    </div>
    
    <button class="btn btn-main" style="width:100%" onclick="generateShare()">üöÄ Publish Share</button>

    <div style="margin-top:40px;">
        <h3>My Recent Shares</h3>
        <div id="historyList" class="history-list"></div>
    </div>
</div>

<div class="container share-view" id="view-ui">
    <h2 id="view-title" style="color:var(--neon)"></h2>
    <textarea id="view-editor" readonly></textarea>
    <div class="grid-inputs" style="margin-top:15px;">
        <button class="btn btn-sec" onclick="copyViewText()">üìã Copy</button>
        <button class="btn btn-sec" onclick="downloadViewText()">üíæ Download</button>
        <button class="btn btn-main" onclick="location.href='./'">üÜï New</button>
    </div>
</div>

<script>
    const user = localStorage.getItem('loggedUser');
    const authBox = document.getElementById('auth-box');
    const passInput = document.getElementById('share-pass');
    const uploadBtn = document.getElementById('btn-upload');

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–∞
    if(user) {
        authBox.innerHTML = `<span>${user}</span> | <button class="btn btn-sec" onclick="logout()">Logout</button>`;
    } else {
        authBox.innerHTML = `<button class="btn btn-sec" onclick="location.href='./login'">Login</button>`;
        
        // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è –≥–æ—Å—Ç–µ–π
        passInput.disabled = true;
        document.getElementById('pass-hint').style.display = 'block';
        
        uploadBtn.disabled = true;
        document.getElementById('file-hint').style.display = 'block';
    }

    function logout() { localStorage.removeItem('loggedUser'); location.reload(); }

    function handleFileUpload(input) {
        if(!user) return;
        const file = input.files[0];
        const reader = new FileReader();
        reader.onload = (e) => { 
            document.getElementById('editor').value = e.target.result;
            document.getElementById('share-title').value = file.name;
        };
        reader.readAsText(file);
    }

    function generateShare() {
        const title = document.getElementById('share-title').value;
        const text = document.getElementById('editor').value;
        if(!title) return alert("Title required!");

        const data = {
            t: title,
            c: text,
            p: user ? document.getElementById('share-pass').value : '',
            ts: Date.now(),
            u: user || 'Guest'
        };

        const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
        const link = window.location.origin + window.location.pathname + "?s=" + encoded;

        let history = JSON.parse(localStorage.getItem('qs_history') || '[]');
        history.push({ ...data, url: link });
        localStorage.setItem('qs_history', JSON.stringify(history));

        prompt("Share Link:", link);
        loadHistory();
    }

    function loadHistory() {
        const list = document.getElementById('historyList');
        const history = JSON.parse(localStorage.getItem('qs_history') || '[]');
        list.innerHTML = '';
        history.slice().reverse().forEach(item => {
            const card = document.createElement('div');
            card.className = 'share-card';
            card.innerHTML = `<div>${item.t}</div> <button class="btn btn-sec" onclick="location.href='${item.url}'">Open</button>`;
            list.appendChild(card);
        });
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Å—ã–ª–∫–∏ (View Mode)
    const urlParams = new URLSearchParams(window.location.search);
    if(urlParams.has('s')) {
        document.getElementById('main-ui').style.display = 'none';
        document.getElementById('view-ui').style.display = 'block';
        const data = JSON.parse(decodeURIComponent(escape(atob(urlParams.get('s')))));
        
        if(data.p) {
            if(prompt("Password:") !== data.p) { alert("Wrong!"); location.href='./'; }
        }
        document.getElementById('view-title').innerText = data.t;
        document.getElementById('view-editor').value = data.c;
    }

    function copyViewText() { navigator.clipboard.writeText(document.getElementById('view-editor').value); alert("Copied!"); }
    function downloadViewText() {
        const blob = new Blob([document.getElementById('view-editor').value], {type: 'text/plain'});
        const a = document.createElement('a');
        a.download = "share.txt"; a.href = URL.createObjectURL(blob); a.click();
    }

    loadHistory();
</script>
</body>
</html>
