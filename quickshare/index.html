<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>QuickShare NY 2026 - Pro Mode</title>
    <style>
        :root { --neon: #00ff88; --bg: #020617; --card: #0f172a; }
        body { background: radial-gradient(circle, #0a192f, var(--bg)); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; min-height: 100vh; }
        header { background: rgba(0,0,0,0.4); padding: 15px 40px; display: flex; justify-content: space-between; border-bottom: 1px solid #1e293b; }
        .container { max-width: 1000px; margin: 30px auto; padding: 20px; background: var(--card); border-radius: 15px; border: 1px solid #334155; }
        textarea { width: 100%; height: 350px; background: #000; color: var(--neon); border: 1px solid #1e293b; padding: 15px; box-sizing: border-box; font-family: monospace; border-radius: 8px; }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        input { background: #1e293b; border: 1px solid #334155; color: white; padding: 10px; border-radius: 5px; }
        .btn { padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.3s; }
        .btn-main { background: var(--neon); color: #020617; }
        .btn-sec { background: #334155; color: white; }
        .share-view { display: none; } /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        #login-warning { color: #ff4444; font-size: 12px; display: none; }
    </style>
</head>
<body>

<header>
    <div style="color:var(--neon); font-weight:bold; font-size:22px;">‚ùÑÔ∏è QUICKSHARE PRO</div>
    <div id="auth-box"></div>
</header>

<div class="container" id="main-ui">
    <input type="text" id="share-title" placeholder="Share Title (Required)" style="width: 100%; margin-bottom: 15px;">
    
    <textarea id="editor" placeholder="Paste your code or text here..."></textarea>
    
    <div class="controls">
        <input type="text" id="share-pass" placeholder="Password Protection (Optional)">
        <input type="text" id="share-custom" placeholder="Custom URL (Logged in only)" id="custom-url-input">
        <input type="file" id="file-upload" style="display:none" onchange="handleFileUpload(this)">
        <button class="btn btn-sec" onclick="document.getElementById('file-upload').click()">üìÇ Upload File</button>
        <button class="btn btn-main" onclick="generateShare()">üöÄ Generate Share Link</button>
    </div>
    <p id="login-warning">Login to use Custom URLs and Permanent Shares!</p>
</div>

<div class="container share-view" id="view-ui">
    <h2 id="view-title">Title</h2>
    <textarea id="view-editor" readonly></textarea>
    <div class="controls">
        <button class="btn btn-sec" onclick="copyViewText()">üìã Copy</button>
        <button class="btn btn-sec" onclick="downloadViewText()">üíæ Download</button>
        <button class="btn btn-main" onclick="location.href='./'">üÜï Create New</button>
    </div>
</div>

<script>
    const user = localStorage.getItem('loggedUser');
    const authBox = document.getElementById('auth-box');

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    if(user) {
        authBox.innerHTML = `<span>${user}</span> | <button class="btn btn-sec" onclick="logout()">Logout</button>`;
    } else {
        authBox.innerHTML = `<button class="btn btn-sec" onclick="location.href='./login'">Login</button> <button class="btn btn-sec" onclick="location.href='./signup'">Sign Up</button>`;
        document.getElementById('share-custom').disabled = true;
        document.getElementById('login-warning').style.display = 'block';
    }

    function logout() { localStorage.removeItem('loggedUser'); location.reload(); }

    // –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏
    function handleFileUpload(input) {
        const file = input.files[0];
        const reader = new FileReader();
        
        // –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç (–∏–ª–∏ –∫–æ–¥)
        if (file.type.match('text.*') || file.name.match(/\.(py|js|css|html|php|sh|json)$/)) {
            reader.onload = (e) => document.getElementById('editor').value = e.target.result;
            reader.readAsText(file);
        } else {
            // –ï—Å–ª–∏ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª
            document.getElementById('editor').value = "[BINARY FILE DETECTED: " + file.name + "]\nSize: " + file.size + " bytes.\n(Download link will be generated)";
        }
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Share
    function generateShare() {
        const title = document.getElementById('share-title').value;
        const text = document.getElementById('editor').value;
        const pass = document.getElementById('share-pass').value;
        const custom = document.getElementById('share-custom').value;

        if(!title) return alert("Title is mandatory!");

        // –ö–æ–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Base64 –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ URL
        const data = {
            t: title,
            c: text,
            p: pass,
            ts: Date.now(),
            g: !user
        };
        const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
        
        // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –º—ã –±—ã —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ –≤ –±–∞–∑—É, –∑–¥–µ—Å—å –ø—Ä–æ—Å—Ç–æ –∏–º–∏—Ç–∏—Ä—É–µ–º
        const finalUrl = window.location.origin + window.location.pathname + "?s=" + encoded + (custom ? "&path=" + custom : "");
        
        prompt("Your Share Link (Active for 72h for guests):", finalUrl);
        
        // –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
        if(user) {
            let history = JSON.parse(localStorage.getItem('user_shares_' + user) || '[]');
            history.push({title, url: finalUrl});
            localStorage.setItem('user_shares_' + user, JSON.stringify(history));
        }
    }

    // –õ–æ–≥–∏–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä ?s= –≤ URL)
    const urlParams = new URLSearchParams(window.location.search);
    if(urlParams.has('s')) {
        document.getElementById('main-ui').style.display = 'none';
        document.getElementById('view-ui').style.display = 'block';
        
        try {
            const rawData = JSON.parse(decodeURIComponent(escape(atob(urlParams.get('s')))));
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
            if(rawData.p) {
                let attempts = 0;
                let access = false;
                while(attempts < 3) {
                    let p = prompt("This share is protected. Enter password:");
                    if(p === rawData.p) { access = true; break; }
                    attempts++;
                    alert("Wrong! " + (3-attempts) + " attempts left.");
                }
                if(!access) {
                    alert("Locked.");
                    location.href = './';
                }
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ 72 —á–∞—Å–æ–≤ –¥–ª—è –≥–æ—Å—Ç–µ–π
            if(rawData.g && (Date.now() - rawData.ts > 72*3600*1000)) {
                alert("This Guest share has expired (72h limit).");
                location.href = './';
            }

            document.getElementById('view-title').innerText = rawData.t;
            document.getElementById('view-editor').value = rawData.c;
        } catch(e) { alert("Invalid Share Link"); }
    }

    function copyViewText() {
        navigator.clipboard.writeText(document.getElementById('view-editor').value);
        alert("Copied!");
    }

    function downloadViewText() {
        const blob = new Blob([document.getElementById('view-editor').value], {type: 'text/plain'});
        const a = document.createElement('a');
        a.download = document.getElementById('view-title').innerText + ".txt";
        a.href = URL.createObjectURL(blob);
        a.click();
    }
</script>
</body>
</html>
